var Workout4bJSON = 
[
    ["","","","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","Week 1","LEVELS 11-15","","","","","Speed",null,"","","","","","","","","","","Speed",null,"","",""  ],
    ["","Day 1","","S x R","RPE","Strength Drop","","Day 2",null,"S x R","RPE","Strength Stop","","Day 3","","S x R","RPE","Strength Drop","","Day 4",null,"S x R","RPE","Strength Stop"  ],
    ["","Squat","","4","9","10%","","RFD Load",null,"5 x 2","","","","Hinge","","4","9","10%","","RFD Unload 1",null,"3 x 6","",""  ],
    ["","Hinge","-1","4 x 6","9","","","Med Ball",null,"3 x 8","","","","LB Uni Push","","6","9","10%","","RFD Unload 2",null,"3 x 6","",""  ],
    ["","LB Uni Push","-1","4 x 8","8-9","","","UB Hor Push",null,"3","7","8","","Squat","-1","4 x 8","8-9","","","UB Vert Push",null,"3","7","8"  ],
    ["","UB Hor Pull","","4 x 8","8-9","","","UB Vert Push",null,"4","7","8","","UB Vert Pull","","4 x #","8-9","","","UB Hor Push",null,"3","7","8"  ],
    ["","Iso 1","","2 x 12","8","","","Carry",-1,"3 x 30yds","","","","Iso 2","","2x 12","8","","","Carry",null,"3 x 30yds","",""  ],
    ["","Iso 3","","2 x 12","8","","","Ant Chain",null,"3 x #","7","","","Iso 4","","2 x 12","8","","","Post Chain",null,"3 x #","7",""  ],
    ["","","","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","Week 2","Speed","","","","","",null,"","","","","","Speed","","","","","",null,"","",""  ],
    ["","Day 1","","S x R","RPE","Strength Stop","","Day 2",null,"S x R","RPE","Strength Drop","","Day 3","","S x R","RPE","Strength Stop","","Day 4",null,"S x R","RPE","Strength Drop"  ],
    ["","RFD Load","","4 x 3","","","","UB Hor Push",null,"3","9","10%","","RFD Unload 1","","3 x 5","","","","UB Vert Push",null,"3","9","10%"  ],
    ["","Med Ball","","3 x 6","","","","UB Vert Pull",null,"#","9","Stop: 10","","RFD Unload 2","","3 x 5","","","","UB Hor Pull",null,"6","9","10%"  ],
    ["","Squat","","3","7","8","","UB Hor Pull",-1,"4 x 8","8-9","","","Hinge","","3","7","8","","UB Hor Push",-1,"4 x 6","8-9",""  ],
    ["","Hinge","-1","4 x 6","7","","","UB Vert Push",-1,"4 x 6","8-9","","","LB Uni Push","","4","7","8","","UB Vert Pull",-1,"4 x 8","8-9",""  ],
    ["","Ant Chain","","3 x #","7","","","Iso 1",null,"2 x 12","8","","","Squat","-1","4x 6","7","","","Iso 2",null,"2x 12","8",""  ],
    ["","Post Chain","","3 x #","7","","","Iso 3",null,"2 x 12","8","","","Carry","","3 x 30yds","7","","","Iso 4",null,"2 x 12","8",""  ],
    ["","","","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","Week 3","ALLOY SET","","","","","Speed",null,"","","","","","","","","","","Speed",null,"","",""  ],
    ["","Day 1","","S x R","RPE","A","","Day 2",null,"S x R","RPE","Strength Stop","","Day 3","","S x R","RPE","A","","Day 4",null,"S x R","RPE","Strength Stop"  ],
    ["","Squat","","6,4,3,#","7,7.5,8,10","3+","","RFD Load",null,"5x 2","","","","Hinge","","6,4,3,#","7,7.5,8,10","3+","","RFD Unload 1",null,"3 x 6","",""  ],
    ["","Hinge","-1","3 x 5","8-9","","","Med Ball",null,"3 x 5","","","","LB Uni Push","","8,6,4,#","7,7.5,8,10","4+","","RFD Unload 2",null,"3 x 6","",""  ],
    ["","LB Uni Push","-1","3 x 5","8","","","UB Hor Push",null,"2","7","8","","Squat","-1","3 x 5","8","","","UB Vert Push",null,"2","7","8"  ],
    ["","Iso 1","","3 x 8","8","","","UB Vert Push",null,"4","7","8","","Iso 2","","3 x 8","8","","","UB Hor Push",null,"2","7","8"  ],
    ["","Iso 3","","3 x 8","8","","","Carry",-1,"3 x 30yds","","","","Iso 4","","3 x 8","8","","","Carry",null,"3 x 30yds","",""  ],
    ["","","","","","","","Ant Chain",null,"3 x #","7","","","","","","","","","Post Chain",null,"3 x #","7",""  ],
    ["","","","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","Week 4","ALLOY SET","","Speed","","","",null,"","","","","Speed","","","","","","",null,"","",""  ],
    ["","Day 1","","S x R","RPE","Strength Stop","","Day 2",null,"S x R","RPE","A","","Day 3","","S x R","RPE","Strength Stop","","Day 4",null,"S x R","RPE","A"  ],
    ["","RFD Load","","5 x 2","","","","UB Hor Push",null,"6,4,3,#","7,7.5,8,10","3+","","RFD Unload 1","","3 x 5","","","","UB Vert Push",null,"6,4,3,#","7,7.5,8,10","3+"  ],
    ["","Med Ball","","3 x 5","","","","UB Vert Pull",null,"8,6,6,#","7,7.5,8,10","6+","","RFD Unload 2","","3 x 5","","","","UB Hor Pull",null,"8,6,6,#","7,7.5,8,10","6+"  ],
    ["","Squat","","2","7","8","","UB Hor Pull",-1,"3 x 8","8","","","Hinge","","2","7","8","","UB Hor Push",-1,"3 x 5","8",""  ],
    ["","Hinge","-1","3 x 5","8","","","UB Vert Push",-1,"3 x 5","8","","","LB Uni Push","","4","7","8","","UB Vert Pull",-1,"3 x 8","8",""  ],
    ["","LB Uni Push","-1","3 x 6","7","","","Iso 1",null,"3 x 8","8","","","Carry","-1","3 x 30yds","","","","Iso 2",null,"3 x 8","8",""  ],
    ["","","","","","","","Iso 3",null,"3 x 8","8","","","","","","","","","Iso 4",null,"3 x 8","8",""  ],
    ["","","","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","","","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","Week 5","Deload","","","","","",null,"","","","","","","","","","","",null,"","",""  ],
    ["","Day 1","","S x R","RPE","","","Day 2",null,"S x R","RPE","","","Day 3","","S x R","RPE","","","",null,"","",""  ],
    ["","Squat","-2","3 x 15","4-5","","","RFD Unload 1",null,"3 x 10","","","","UB Hor Push","","3 x 15","4-5","","","",null,"","",""  ],
    ["","Hinge","-2","3 x 15","4-5","","","RFD Unload 2",null,"3 x 10","","","","UB Hor Pull","","3 x 15","4-5","","","",null,"","",""  ],
    ["","LB Uni Push","-2","2 x 20","4-5","","","RFD Load",null,"6 x 3","","","","Iso 1","","2 x 20","4-5","","","",null,"","",""  ],
    ["","Ant Chain","","2 x #","4-5","","","Med Ball",null,"4 x 8","","","","Iso 2","","2 x20","4-5","","","",null,"","",""  ],
    ["","","","","","","","Carry",null,"2 x :60","","","","","","","","","","",null,"","",""  ]
  ]

var JSONList = Workout4bJSON

var Output = {
    Templates: {
        1: {},
        2: {},
        3: {},
        4: {},
        5: {}
    },
    getWeekDay: {},
    getID: {}
}

var TemplateNum = 0;
for (var W = 1; W <= 4; W++) {
  for (var D = 1; D <= 4; D++) {
      TemplateNum ++;
      if (!(W in Output.getID)) {
        Output.getID[W] = {}
        Output.getID[W][D] = TemplateNum;
      }
      else {
        Output.getID[W][D] = TemplateNum;
      }
      Output.Templates[W][D] = {
          ID: TemplateNum,
          Week: W,
          Day: D,
          NPatterns: 0,
          Patterns: {}
      }
      Output.getWeekDay[TemplateNum] = {Week: W, Day: D};
  }
}
for (var D = 1; D <= 3; D++) {
    TemplateNum ++;
    if (!(5 in Output.getID)) {
        Output.getID[5] = {}
        Output.getID[5][D] = TemplateNum;
    }
    else {
        Output.getID[5][D] = TemplateNum;
    }
    Output.Templates[5][D] = {
        ID: TemplateNum,
        Week: 5,
        Day: D,
        NPatterns: 0,
        Patterns: {}
    }
    Output.getWeekDay[TemplateNum] = {Week: 5, Day: D};  
}

module.exports = Output;


var thisWeek = 0;
var thisDay = 0;
var thisSpecial = "";
var specialsList = ["", "", "", ""];


JSONList.forEach(elem => {
    var AllDays = [
        elem.slice(1, 7),
        elem.slice(7, 13),
        elem.slice(13, 19),
        elem.slice(19),    
    ]
    if (AllDays[0][0].includes("Week")) {
        thisWeek = parseInt(AllDays[0][0].split(" ")[1].trim());
        // console.log("thisWeek(1): " + thisWeek);
    }

    for (var i = 0; i < AllDays.length; i ++) {
        if (thisWeek == 0) {
            continue;
        }
        var dayRow = AllDays[i];
        var dayNum = i + 1;
        thisDay = dayNum;
        if (dayRow[0].includes("Day")) {
            // console.log("Workout Template: " + " Week, Day: ", thisWeek, thisDay);
            if (dayRow[4] != "") {
                if (dayRow[4].includes("Stop")) {
                    thisSpecial = "Strength Stop";
                    specialsList[dayNum - 1] = "Strength Stop";
                }
                else if (dayRow[4].includes("Drop")) {
                    thisSpecial = "Strength Drop";
                    specialsList[dayNum - 1] = "Strength Drop";                    
                }
                else if (dayRow[4].includes("A")) {
                    thisSpecial = "Alloy";
                    specialsList[dayNum - 1] = "Alloy";
                }
                // console.log("   Special Type: " + thisSpecial);
            }
            // console.log(Workouts3b.Templates[thisWeek][thisDay]);
        }        
        if (AllDays[0][0].includes("Week") || AllDays[0][0].includes("Day") || dayRow[0] == "") {
            // continue;
        }
        else {
            // console.log("thisWeek", thisWeek);
            // console.log("thisDay", thisDay);
            Output.Templates[thisWeek][thisDay].NPatterns ++;
            var PatternNum = Output.Templates[thisWeek][thisDay].NPatterns;
            var PatternDict = {
                ExerciseType: dayRow[0].trim(),
                Reps: dayRow[2],                
            };
            //     if (item[0] != "") {
            var refDict = {};
            refDict["EType"] = dayRow[0];
            refDict["Deload"] = dayRow[1];
            refDict["SxR"] = dayRow[2];
            refDict["RPE"] = dayRow[3];
            refDict["Special"] = dayRow[4];

            // SETS AND REPS
            if (refDict["SxR"].includes("x") || refDict["SxR"].includes("X")) {
                var splitChar = "x";
                var Sets = parseInt(refDict["SxR"].trim().split(splitChar)[0]);    
                var Reps = refDict["SxR"].trim().split(splitChar)[1];
                PatternDict.Sets = Sets;
                PatternDict.Reps = parseInt(Reps.trim());
                // SETS AND REPS
                if (PatternDict.ExerciseType == "Carry") {
                    if (Reps.includes(":")) {
                        PatternDict.Reps = parseInt(Reps.trim().slice(1));
                        PatternDict.Seconds = PatternDict.Reps;
                    }
                    else {
                        PatternDict.Reps = parseInt(Reps.trim());
                        PatternDict.Seconds = PatternDict.Reps;                        
                    }
                    PatternDict.Type = "carry";
                }
                else if (Reps.includes("#") || Reps == "#") {
                    PatternDict.Reps = "Bodyweight";             
                    PatternDict.Type = "Bodyweight";       
                }
            }
            // STAGGERED REPS
            else if (refDict["SxR"].includes(",")) {
                var repSplit = refDict["SxR"].trim().split(",");
                var repList = [];
                var setCount = 0;
                repSplit.forEach((reps) => {
                    if (reps != "#") {
                        repList.push(parseInt(reps));
                        setCount ++;                        
                    }
                })
                PatternDict.Reps = repList;
                PatternDict.Sets = setCount;
                PatternDict.SplitSets = true;
            }
            else {
                PatternDict.Sets = 1;
                if (refDict["SxR"] == "#") {
                    PatternDict.Reps = "Bodyweight";
                }
                else {
                    PatternDict.Reps = parseInt(refDict["SxR"].trim());                    
                }
            }
            //DELOAD
            if (refDict["Deload"] != "" && refDict["Deload"] != null) {
                PatternDict.Deload = parseInt(refDict["Deload"]);
            }
            // RPE
            if (refDict["RPE"] != "" && refDict["RPE"] != null) {
                if (refDict["RPE"].includes("-")) {
                    PatternDict.RPE = refDict["RPE"];
                }
                else {
                    PatternDict.RPE = parseFloat(refDict["RPE"]);
                }
            }
                
            //Special Val
            if (refDict["Special"] != "") {

                if (specialsList[dayNum - 1] == "Strength Stop") {
                    PatternDict.Type = "stop";
                    PatternDict.StopRPE = parseFloat(refDict["Special"]);
                }
                else if (specialsList[dayNum - 1] == "Strength Drop"
                || specialsList[dayNum - 1].includes("Drop")) {
                    PatternDict.Type = "drop";
                    PatternDict.DropValue = parseFloat(refDict["Special"]);
                }
                else if (specialsList[dayNum - 1] == "Alloy") {
                    PatternDict.Alloy = true;
                    PatternDict.AlloyReps = parseInt(refDict["Special"]);
                }
                PatternDict.Special = specialsList[dayNum - 1];
            }
            Output.Templates[thisWeek][thisDay].Patterns[PatternNum] = PatternDict;

            //       thisTemplate.Patterns[thisTemplate.NPatterns] = PatternDict;

            //       // 1: {ExerciseType: "UB Hor Push", Reps: 8, RPE: 7, Type: "drop", DropValue: 7,},
            //       // 1: {ExerciseType: "UB Hor Push", Reps: 8, RPE: 7, Type: "drop", DropValue: 7,},
            //       // 2: {ExerciseType: "UB Vert Pull", Reps: 7, RPE: 7, Type: "stop", StopRPE: 8.5,},
            //       // 3: {ExerciseType: "UB Hor Pull",  Sets: 4, Reps: 10, RPE: 7, Deload: -1},
            //       // 4: {ExerciseType: "Iso 1",  Sets: 3, Type: "bodyweight", Reps: 12, RPE: 7},
            //       // 5: {ExerciseType: "Iso 3",  Sets: 3, Type: "carry", Reps: 12, RPE: 7},
            //       // 1: {ExerciseType: "Hinge", Sets: 3, Reps: 10, RPE: 7,},

            //       // ["W1D4","Ant Chain","","2 x #","4-5",""  ]
            //       // console.log(item, week, day);
            //       // console.log(84, Workouts3a.Templates[week][day]);
            //         //Assign to workout object here

            // console.log("   Pattern Detected: " + dayRow[0]);            
        }
    }


    AllDays.forEach(day => {

    })


    var D1List = elem.slice(1, 7);
    var D2List = elem.slice(7, 13);
    var D3List = elem.slice(13, 19);
    var D4List = elem.slice(19);
    
    // console.log(elem[1], elem[7], elem[13]);
    // console.log("Day 1: " + elem.slice(1, 7));
    // console.log("Day 2: " +  elem.slice(7, 13));
    // console.log("Day 3: " +  elem.slice(13, 19));
    // console.log("Day 4: " + elem.slice(19))
    // console.log(elem.slice(7));
})
